import{r as n,c as S,B as G,a as O,L as J,o as K,G as Q,b as F,w as E,d as X,u as Y,f as s,g as Z,i as l,h as t,q as w,s as ee,A as te,j as b,F as x,m as z,k as v,t as d,l as m,p as L,v as re,z as oe,y as ae,E as A}from"./index-C4Um7Kjq.js";import{_ as se}from"./PageHeader-Czcs01bb.js";import{u as le}from"./notes-YTv23Aak.js";import{s as ne}from"./sections-BygJVMTa.js";import{t as ie}from"./tags-SncAe3P9.js";const de={key:1,class:"bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-100 dark:border-gray-700 overflow-hidden"},ue={key:0,class:"bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-200 p-4 rounded-lg border border-red-100 dark:border-red-800/30"},ce={class:"flex"},ge={key:0},ve={key:1},ye={class:"col-span-2"},fe={class:"flex justify-between items-center mb-1.5"},be={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},me={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},xe={key:0,class:"fixed inset-0 bg-white dark:bg-gray-800 z-50 flex flex-col p-4"},pe={class:"flex justify-between items-center mb-4"},ke={class:"text-lg font-medium text-gray-800 dark:text-white"},we={key:0,class:"mt-2 flex items-center text-xs text-gray-500 dark:text-gray-400"},he={class:"relative"},_e=["value"],Ce={class:"flex flex-wrap gap-2"},Ne=["onClick"],Se={class:"flex items-center"},ze={key:0,class:"w-1.5 h-1.5 rounded-full bg-white mr-1.5"},Le={class:"flex items-center space-x-6"},Me={class:"flex items-center"},Be={class:"relative flex items-center"},Ve={class:"h-4 w-4 rounded flex items-center justify-center border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"},Fe={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 text-blue-500",viewBox:"0 0 20 20",fill:"currentColor"},Ee={class:"flex items-center"},Ae={class:"relative flex items-center"},je={class:"h-4 w-4 rounded flex items-center justify-center border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"},Te={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 text-blue-500",viewBox:"0 0 20 20",fill:"currentColor"},Ue={class:"pt-4 flex justify-end space-x-3 border-t border-gray-200 dark:border-gray-700"},He=["disabled"],Ie={key:0,class:"flex items-center"},$e={key:1},Oe={__name:"NoteForm",setup(De){const h=Y(),j=G(),y=le(),_=n(!0),u=n(null),M=n([]),B=n([]),p=S(()=>j.params.id),i=S(()=>!!p.value),C=n(null),g=n({}),N=n(null),k=n(!1),T=n(!0),r=O({title:"",content:"",section:null,tag_ids:[],is_favorite:!1,is_archived:!1});J(()=>{C.value&&clearInterval(C.value)}),K(async()=>{try{await Promise.all([U(),I(),$()])}catch(o){console.error("Error initializing form:",o),u.value="Failed to load form data. Please try again."}finally{_.value=!1}T.value&&(C.value=setInterval(H,2e3))});const f=n(!1),V=()=>{f.value=!f.value,f.value&&setTimeout(()=>{var o;(o=document.getElementById("content"))==null||o.focus()},100)},U=async()=>{try{const o=await ne.getSections();M.value=o.data.results}catch(o){console.error("Failed to load sections:",o)}},H=async()=>{if(i.value&&q.value&&!k.value){k.value=!0;try{const o={title:r.title,content:r.content,section:r.section,tag_ids:r.tag_ids,is_favorite:r.is_favorite,is_archived:r.is_archived,type:"note"};await y.updateNote(p.value,o),N.value=new Date}catch(o){console.error("Auto-save failed:",o)}finally{k.value=!1}}};Q(()=>_.value,o=>{!o&&i.value&&(g.value={...r})});const I=async()=>{try{const o=await ie.getTags();B.value=o.data.results}catch(o){console.error("Failed to load tags:",o)}},$=async()=>{if(i.value)try{const o=await y.fetchNoteById(p.value);r.title=o.title,r.content=o.content||"",r.section=o.section||null,r.is_favorite=o.is_favorite||!1,r.is_archived=o.is_archived||!1,o.tags&&Array.isArray(o.tags)&&(r.tag_ids=o.tags.map(e=>e.id))}catch(o){console.error("Failed to load note:",o),u.value="Failed to load note details"}},D=o=>{const a=Math.floor((new Date-o)/1e3);if(a<60)return"just now";if(a<3600){const c=Math.floor(a/60);return`${c} minute${c>1?"s":""} ago`}else return o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},q=S(()=>i.value?r.title!==g.value.title||r.content!==g.value.content||r.section!==g.value.section||r.is_favorite!==g.value.is_favorite||r.is_archived!==g.value.is_archived||!P(r.tag_ids,g.value.tag_ids||[]):!1),P=(o,e)=>o.length!==e.length?!1:o.every((a,c)=>a===e[c]),R=o=>{const e=r.tag_ids.indexOf(o.id);e===-1?r.tag_ids.push(o.id):r.tag_ids.splice(e,1)},W=async()=>{var o;u.value=null;try{const e={title:r.title,content:r.content,section:r.section,tag_ids:r.tag_ids,is_favorite:r.is_favorite,is_archived:r.is_archived,type:"note"};let a;i.value?a=await y.updateNote(p.value,e):a=await y.createNote(e),h.push("/notes")}catch(e){console.error("Failed to save note:",e),u.value=((o=e.response)==null?void 0:o.data)||"Failed to save note. Please try again."}};return(o,e)=>(s(),F(X,{title:i.value?"Edit Note":"New Note"},{default:E(()=>[Z(se,{title:i.value?"Edit Note":"New Note"},{actions:E(()=>[t("button",{onClick:e[0]||(e[0]=a=>w(h).back()),class:"btn bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 shadow-sm"}," Cancel ")]),_:1},8,["title"]),_.value?(s(),F(ee,{key:0})):(s(),l("div",de,[t("form",{onSubmit:te(W,["prevent"]),class:"p-6 space-y-6"},[u.value?(s(),l("div",ue,[t("div",ce,[e[9]||(e[9]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),t("div",null,[typeof u.value=="object"?(s(),l("p",ge,[(s(!0),l(x,null,z(u.value,(a,c)=>(s(),l("span",{key:c},[v(d(c)+": "+d(Array.isArray(a)?a.join(", "):a),1),e[8]||(e[8]=t("br",null,null,-1))]))),128))])):(s(),l("p",ve,d(u.value),1))])])])):b("",!0),t("div",null,[e[10]||(e[10]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"},[v(" Title "),t("span",{class:"text-red-500"},"*")],-1)),t("div",null,[m(t("input",{id:"title","onUpdate:modelValue":e[1]||(e[1]=a=>r.title=a),type:"text",required:"",class:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-300 dark:focus:ring-gray-600 focus:border-gray-300 dark:focus:border-gray-600",placeholder:"Note title"},null,512),[[L,r.title]])])]),t("div",ye,[t("div",null,[t("div",fe,[e[13]||(e[13]=t("label",{for:"content",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[v(" Content "),t("span",{class:"text-red-500"},"*")],-1)),t("button",{type:"button",onClick:V,class:"text-xs flex items-center px-2 py-1 rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"},[f.value?(s(),l("svg",be,e[11]||(e[11]=[t("path",{"fill-rule":"evenodd",d:"M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z","clip-rule":"evenodd"},null,-1)]))):(s(),l("svg",me,e[12]||(e[12]=[t("path",{"fill-rule":"evenodd",d:"M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 01-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 010-2h4a1 1 0 011 1v4a1 1 0 01-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12zm-9 7a1 1 0 012 0v1.586l2.293-2.293a1 1 0 011.414 1.414L6.414 15H8a1 1 0 010 2H4a1 1 0 01-1-1v-4zm13-1a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 010-2h1.586l-2.293-2.293a1 1 0 011.414-1.414L15 13.586V12a1 1 0 011-1z","clip-rule":"evenodd"},null,-1)]))),v(" "+d(f.value?"Exit Fullscreen":"Fullscreen"),1)])]),t("div",null,[f.value?(s(),l("div",xe,[t("div",pe,[t("h3",ke,d(r.title||"Untitled Note"),1),t("button",{type:"button",onClick:V,class:"p-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"},e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]))]),m(t("textarea",{id:"content-fullscreen","onUpdate:modelValue":e[2]||(e[2]=a=>r.content=a),class:"flex-1 w-full p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-300 dark:focus:ring-gray-600 focus:border-gray-300 dark:focus:border-gray-600",placeholder:"Write your note here..."},null,512),[[L,r.content]]),i.value?(s(),l("div",we,[k.value?(s(),l(x,{key:0},[e[15]||(e[15]=t("svg",{class:"animate-spin mr-1 h-3 w-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),e[16]||(e[16]=v(" Auto-saving... "))],64)):N.value?(s(),l(x,{key:1},[v(" Last saved "+d(D(N.value)),1)],64)):b("",!0)])):b("",!0)])):m((s(),l("textarea",{key:1,id:"content","onUpdate:modelValue":e[3]||(e[3]=a=>r.content=a),rows:"16",required:"",class:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-300 dark:focus:ring-gray-600 focus:border-gray-300 dark:focus:border-gray-600",placeholder:"Write your note here..."},null,512)),[[L,r.content]])])])]),t("div",null,[e[19]||(e[19]=t("label",{for:"section",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," Section ",-1)),t("div",he,[m(t("select",{id:"section","onUpdate:modelValue":e[4]||(e[4]=a=>r.section=a),class:"w-full appearance-none px-3 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-1 focus:ring-gray-300 dark:focus:ring-gray-600 focus:border-gray-300 dark:focus:border-gray-600"},[e[17]||(e[17]=t("option",{value:null},"None",-1)),(s(!0),l(x,null,z(M.value,a=>(s(),l("option",{key:a.id,value:a.id},d(a.title),9,_e))),128))],512),[[re,r.section]]),e[18]||(e[18]=t("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Tags ",-1)),t("div",Ce,[(s(!0),l(x,null,z(B.value,a=>(s(),l("div",{key:a.id,onClick:c=>R(a),class:ae(["px-3 py-1.5 rounded-full text-sm cursor-pointer transition-all duration-200 border",r.tag_ids.includes(a.id)?"text-white shadow-sm":"text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700"]),style:oe(r.tag_ids.includes(a.id)?{backgroundColor:a.color,borderColor:a.color}:{})},[t("div",Se,[r.tag_ids.includes(a.id)?(s(),l("span",ze)):b("",!0),t("span",null,d(a.name),1)])],14,Ne))),128))])]),t("div",Le,[t("div",Me,[t("div",Be,[m(t("input",{id:"is_favorite","onUpdate:modelValue":e[5]||(e[5]=a=>r.is_favorite=a),type:"checkbox",class:"opacity-0 absolute h-4 w-4 cursor-pointer"},null,512),[[A,r.is_favorite]]),t("div",Ve,[r.is_favorite?(s(),l("svg",Fe,e[21]||(e[21]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):b("",!0)]),e[22]||(e[22]=t("label",{for:"is_favorite",class:"ml-2 block text-sm text-gray-700 dark:text-gray-300 cursor-pointer"}," Mark as favorite ",-1))])]),t("div",Ee,[t("div",Ae,[m(t("input",{id:"is_archived","onUpdate:modelValue":e[6]||(e[6]=a=>r.is_archived=a),type:"checkbox",class:"opacity-0 absolute h-4 w-4 cursor-pointer"},null,512),[[A,r.is_archived]]),t("div",je,[r.is_archived?(s(),l("svg",Te,e[23]||(e[23]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):b("",!0)]),e[24]||(e[24]=t("label",{for:"is_archived",class:"ml-2 block text-sm text-gray-700 dark:text-gray-300 cursor-pointer"}," Archive note ",-1))])])]),t("div",Ue,[t("button",{type:"button",onClick:e[7]||(e[7]=a=>w(h).back()),class:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-gray-800 focus:ring-gray-500 transition-colors"}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-gray-800 to-gray-700 dark:from-gray-700 dark:to-gray-600 border border-gray-700 dark:border-gray-600 rounded-lg hover:from-gray-700 hover:to-gray-600 dark:hover:from-gray-600 dark:hover:to-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-gray-800 focus:ring-gray-500 shadow-sm transition-all",disabled:w(y).loading},[w(y).loading?(s(),l("span",Ie,e[25]||(e[25]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),v(" Saving... ")]))):(s(),l("span",$e,d(i.value?"Update Note":"Create Note"),1))],8,He)])],32)]))]),_:1},8,["title"]))}};export{Oe as default};
