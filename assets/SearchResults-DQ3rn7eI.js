import{r as g,a as rt,B as at,G as it,c as B,o as lt,J as nt,b as z,w as j,d as dt,u as ct,e as ut,f as a,g as E,h as s,i as l,q as gt,k as x,l as F,n as pt,p as yt,v as V,F as h,m as v,t as c,z as L,y as w,j as b,s as ht,x as vt,A as $}from"./index-Cx2El54a.js";import{_ as ft}from"./PageHeader-CLbsVlwg.js";import{_ as kt}from"./ElementCard-BjjpXRTf.js";import{t as mt}from"./todos-Q-LE40Es.js";import{t as xt}from"./tags-DKUyxjwe.js";import{s as wt}from"./sections-CkNSaj2W.js";const bt={class:"flex space-x-2"},_t={class:"mb-6 bg-white dark:bg-gray-800 shadow p-4 rounded-lg"},Ct={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},St={class:"md:col-span-2"},qt={class:"relative rounded-md shadow-sm"},$t=["value"],Mt={class:"mt-4"},Tt={class:"flex flex-wrap gap-2"},Bt=["onClick"],zt={class:"mt-4 flex justify-between items-center"},jt={key:0,class:"flex space-x-2"},Et={class:"dropdown relative"},Ft={key:0,class:"absolute mt-2 w-40 bg-white dark:bg-gray-800 rounded-md shadow-lg z-10 py-1"},Qt=["disabled"],Nt=["disabled"],At={class:"dropdown relative"},Rt={key:0,class:"absolute mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-10 py-1"},Vt=["onClick"],Lt={key:1},Dt={key:0,class:"mt-4"},It={key:1},Ot={class:"flex justify-between items-center mb-4"},Ht={class:"text-sm text-gray-500 dark:text-gray-400"},Jt={class:"flex bg-gray-200 dark:bg-gray-700 rounded-lg p-1"},Ut={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},Gt={key:1,class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},Kt={class:"divide-y divide-gray-200 dark:divide-gray-700"},Pt={class:"px-4 py-4 sm:px-6 flex justify-between"},Zt=["onClick"],Wt={class:"flex items-center mb-1"},Xt={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},Yt={class:"text-sm text-gray-500 dark:text-gray-400 line-clamp-1"},te={key:0,class:"mt-2 flex flex-wrap gap-1"},ee=["onClick"],se={class:"ml-4 flex flex-shrink-0 items-center"},oe=["checked","onClick"],re=["onClick"],ae=["onClick"],pe={__name:"SearchResults",setup(ie){const p=ct(),u=at(),f=g(!0),d=g([]),_=g([]),C=g([]),k=g("grid"),M=g(!1),S=g(!1),y=g("relevance"),D=[{label:"Relevance",value:"relevance"},{label:"Newest First",value:"newest"},{label:"Oldest First",value:"oldest"},{label:"Title (A-Z)",value:"title_asc"},{label:"Title (Z-A)",value:"title_desc"}],o=rt({searchQuery:u.query.q||"",type:u.query.type||null,section:u.query.section||null,tags:u.query.tag?Array.isArray(u.query.tag)?u.query.tag:[u.query.tag]:[]});it(()=>u.query,t=>{o.searchQuery=t.q||"",o.type=t.type||null,o.section=t.section||null,o.tags=t.tag?Array.isArray(t.tag)?t.tag:[t.tag]:[],T()},{immediate:!1,deep:!0});const Q=B(()=>{let t=[...d.value];return o.tags.length>0&&t.sort((e,i)=>{const r=e.tags.filter(q=>o.tags.includes(q.id.toString())).length,n=i.tags.filter(q=>o.tags.includes(q.id.toString())).length;return r!==n?n-r:0}),y.value!=="relevance"&&t.sort((e,i)=>y.value==="newest"?new Date(i.created_at)-new Date(e.created_at):y.value==="oldest"?new Date(e.created_at)-new Date(i.created_at):y.value==="title_asc"?e.title.localeCompare(i.title):y.value==="title_desc"?i.title.localeCompare(e.title):0),t}),I=B(()=>d.value.some(t=>t.type==="flashcard")),O=B(()=>d.value.some(t=>t.type==="question"||t.type==="multiple_choice"));lt(async()=>{await Promise.all([H(),J()]),U()?await T():f.value=!1});const H=async()=>{try{const t=await xt.getTags();_.value=t.data.results||t.data}catch(t){console.error("Error loading tags:",t)}},J=async()=>{try{const t=await wt.getSections();C.value=t.data.results||t.data}catch(t){console.error("Error loading sections:",t)}},U=()=>o.searchQuery||o.type||o.section||o.tags.length>0,G=()=>{if(o.searchQuery)return`Search Results for '${o.searchQuery}'`;if(o.tags.length===1){const t=_.value.find(e=>e.id.toString()===o.tags[0].toString());if(t)return`Elements tagged with '${t.name}'`}if(o.type)return{note:"Notes",flashcard:"Flashcards",question:"Questions",multiple_choice:"Multiple Choice Questions",todo:"Todos"}[o.type]||"Search Results";if(o.section){const t=C.value.find(e=>e.id.toString()===o.section.toString());if(t)return`Elements in '${t.title}'`}return"Search Results"},K=()=>{let t="We could not find any results";if(o.searchQuery&&(t+=` matching '${o.searchQuery}'`),o.type&&(t+=` in ${{note:"notes",flashcard:"flashcards",question:"questions",multiple_choice:"multiple choice questions",todo:"todos"}[o.type]}`),o.section){const e=C.value.find(i=>i.id.toString()===o.section.toString());e&&(t+=` in section '${e.title}'`)}if(o.tags.length>0){const e=o.tags.map(i=>{const r=_.value.find(n=>n.id.toString()===i.toString());return r?r.name:null}).filter(Boolean);e.length===1?t+=` with tag '${e[0]}'`:e.length>1&&(t+=` with tags ${e.slice(0,-1).join(", ")} and ${e[e.length-1]}`)}return t+"."},T=async()=>{f.value=!0;try{const t={};o.searchQuery&&(t.q=o.searchQuery),o.type&&(t.type=o.type),o.section&&(t.section=o.section),o.tags.length>0&&(t.tag=o.tags);const e=await nt.get("search/",{params:t});d.value=e.data}catch(t){console.error("Error searching elements:",t),d.value=[]}finally{f.value=!1}},m=()=>{const t={};o.searchQuery&&(t.q=o.searchQuery),o.type&&(t.type=o.type),o.section&&(t.section=o.section),o.tags.length>0&&(t.tag=o.tags),p.replace({query:t}),T()},P=t=>{const e=t.toString(),i=o.tags.findIndex(r=>r.toString()===e);i===-1?o.tags.push(e):o.tags.splice(i,1),m()},Z=t=>{o.tags=[t.toString()],m()},N=()=>{o.searchQuery="",o.type=null,o.section=null,o.tags=[],p.replace({query:{}}),d.value=[],f.value=!1},A=async t=>{if(t.type==="todo")try{const e=t.is_completed?"incomplete":"complete";await mt[e+"Todo"](t.id),t.is_completed=!t.is_completed}catch(e){console.error("Error toggling todo completion:",e)}},R=t=>{const i={note:`/notes/${t.id}`,flashcard:`/flashcards/${t.id}/edit`,question:`/questions/${t.id}`,multiple_choice:`/questions/${t.id}`,todo:`/todos/${t.id}`}[t.type];i&&p.push(i)},W=t=>{const i={note:`/notes/${t.id}/edit`,flashcard:`/flashcards/${t.id}/edit`,question:`/questions/${t.id}/edit`,multiple_choice:`/questions/${t.id}/edit`,todo:`/todos/${t.id}`}[t.type];i&&p.push(i)},X=t=>{y.value=t,S.value=!1},Y=()=>{const t=d.value.filter(e=>e.type==="flashcard").map(e=>e.id);t.length>0&&(localStorage.setItem("study_flashcards",JSON.stringify(t)),p.push("/flashcards/study"))},tt=()=>{const t=d.value.filter(e=>e.type==="question"||e.type==="multiple_choice").map(e=>e.id);t.length>0&&(localStorage.setItem("quiz_questions",JSON.stringify(t)),p.push("/questions/quiz"))},et=t=>({note:"Note",flashcard:"Flashcard",question:"Question",multiple_choice:"Multiple Choice",todo:"Todo"})[t]||"Element",st=t=>({note:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",flashcard:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",question:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",multiple_choice:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300",todo:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300"})[t]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",ot=t=>{let e="";return t.type==="todo"?e=t.content:t.type==="flashcard"?e=`Front: ${t.content} | Back: ${t.additional_content}`:(t.type==="question"||t.type,e=t.content),e&&e.length>100?e.substring(0,100)+"...":e};return(t,e)=>{const i=ut("router-link");return a(),z(dt,{title:"Search Results"},{default:j(()=>[E(ft,{title:G()},{actions:j(()=>[s("div",bt,[s("button",{onClick:e[0]||(e[0]=r=>gt(p).back()),class:"btn bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 shadow-sm"}," Back "),E(i,{to:"/search",class:"btn-primary"},{default:j(()=>e[8]||(e[8]=[x(" New Search ")])),_:1})])]),_:1},8,["title"]),s("div",_t,[s("div",Ct,[s("div",St,[e[10]||(e[10]=s("label",{for:"search-query",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Search",-1)),s("div",qt,[F(s("input",{id:"search-query",type:"text","onUpdate:modelValue":e[1]||(e[1]=r=>o.searchQuery=r),onKeyup:pt(m,["enter"]),class:"input w-full pl-10",placeholder:"Search for anything..."},null,544),[[yt,o.searchQuery]]),e[9]||(e[9]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),s("div",null,[e[12]||(e[12]=s("label",{for:"filter-type",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Type",-1)),F(s("select",{id:"filter-type","onUpdate:modelValue":e[2]||(e[2]=r=>o.type=r),onChange:m,class:"input w-full"},e[11]||(e[11]=[s("option",{value:null},"All Types",-1),s("option",{value:"note"},"Notes",-1),s("option",{value:"flashcard"},"Flashcards",-1),s("option",{value:"question"},"Questions",-1),s("option",{value:"multiple_choice"},"Multiple Choice",-1),s("option",{value:"todo"},"Todos",-1)]),544),[[V,o.type]])]),s("div",null,[e[14]||(e[14]=s("label",{for:"filter-section",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Section",-1)),F(s("select",{id:"filter-section","onUpdate:modelValue":e[3]||(e[3]=r=>o.section=r),onChange:m,class:"input w-full"},[e[13]||(e[13]=s("option",{value:null},"All Sections",-1)),(a(!0),l(h,null,v(C.value,r=>(a(),l("option",{key:r.id,value:r.id},c(r.title),9,$t))),128))],544),[[V,o.section]])])]),s("div",Mt,[e[15]||(e[15]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Tags",-1)),s("div",Tt,[(a(!0),l(h,null,v(_.value,r=>(a(),l("button",{key:r.id,onClick:n=>P(r.id),class:w(["px-2 py-1 rounded-full text-xs font-medium transition-colors duration-200",o.tags.includes(r.id.toString())?"ring-2 ring-offset-2 ring-gray-400":""]),style:L({backgroundColor:o.tags.includes(r.id.toString())?r.color:r.color+"20",color:o.tags.includes(r.id.toString())?"white":r.color})},c(r.name),15,Bt))),128))])]),s("div",zt,[d.value.length>0?(a(),l("div",jt,[s("div",Et,[s("button",{onClick:e[4]||(e[4]=r=>M.value=!M.value),class:"btn bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center"},e[16]||(e[16]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1),x(" Actions ")])),M.value?(a(),l("div",Ft,[s("button",{onClick:Y,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",disabled:!I.value}," Study Flashcards ",8,Qt),s("button",{onClick:tt,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",disabled:!O.value}," Start Quiz ",8,Nt)])):b("",!0)]),s("div",At,[s("button",{onClick:e[5]||(e[5]=r=>S.value=!S.value),class:"btn bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center"},e[17]||(e[17]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})],-1),x(" Sort ")])),S.value?(a(),l("div",Rt,[(a(),l(h,null,v(D,r=>s("button",{key:r.value,onClick:n=>X(r.value),class:w(["block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700",y.value===r.value?"text-primary-600 dark:text-primary-400 font-medium":"text-gray-700 dark:text-gray-300"])},c(r.label),11,Vt)),64))])):b("",!0)])])):b("",!0),s("button",{onClick:N,class:"text-sm text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300"}," Reset Filters ")])]),f.value?(a(),z(ht,{key:0})):(a(),l("div",Lt,[d.value.length===0?(a(),l("div",Dt,[E(vt,{title:"No results found",message:K(),"action-text":"New Search",onAction:N},null,8,["message"])])):(a(),l("div",It,[s("div",Ot,[s("p",Ht," Found "+c(d.value.length)+" "+c(d.value.length===1?"result":"results"),1),s("div",Jt,[s("button",{onClick:e[6]||(e[6]=r=>k.value="grid"),class:w(["px-3 py-1 rounded-md text-sm font-medium flex items-center",k.value==="grid"?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow":"text-gray-700 dark:text-gray-300"])},e[18]||(e[18]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})],-1),x(" Grid ")]),2),s("button",{onClick:e[7]||(e[7]=r=>k.value="list"),class:w(["px-3 py-1 rounded-md text-sm font-medium flex items-center",k.value==="list"?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow":"text-gray-700 dark:text-gray-300"])},e[19]||(e[19]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1),x(" List ")]),2)])]),k.value==="grid"?(a(),l("div",Ut,[(a(!0),l(h,null,v(Q.value,r=>(a(),z(kt,{key:r.id,element:r,onToggleComplete:A},null,8,["element"]))),128))])):(a(),l("div",Gt,[s("ul",Kt,[(a(!0),l(h,null,v(Q.value,r=>(a(),l("li",{key:r.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150"},[s("div",Pt,[s("div",{class:"flex-1 cursor-pointer",onClick:n=>R(r)},[s("div",Wt,[s("span",{class:w(["px-2 py-0.5 rounded-full text-xs font-medium mr-2",st(r.type)])},c(et(r.type)),3),s("h3",Xt,c(r.title),1)]),s("p",Yt,c(ot(r)),1),r.tags&&r.tags.length>0?(a(),l("div",te,[(a(!0),l(h,null,v(r.tags,n=>(a(),l("span",{key:n.id,onClick:$(q=>Z(n.id),["stop"]),class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium cursor-pointer",style:L({backgroundColor:n.color+"20",color:n.color})},c(n.name),13,ee))),128))])):b("",!0)],8,Zt),s("div",se,[r.type==="todo"?(a(),l("input",{key:0,type:"checkbox",checked:r.is_completed,onClick:$(n=>A(r),["stop"]),class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded mr-2"},null,8,oe)):b("",!0),s("button",{onClick:$(n=>R(r),["stop"]),class:"p-1 text-gray-400 hover:text-primary-600",title:"View"},e[20]||(e[20]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)]),8,re),s("button",{onClick:$(n=>W(r),["stop"]),class:"p-1 text-gray-400 hover:text-primary-600 ml-1",title:"Edit"},e[21]||(e[21]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,ae)])])]))),128))])]))]))]))]),_:1})}}};export{pe as default};
