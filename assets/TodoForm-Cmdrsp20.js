import{r as p,c as T,B,a as M,o as N,b as S,w as C,d as I,u as U,f as r,g as $,i as l,h as e,q as g,s as O,A as j,j as P,F as v,m as b,k as x,t as n,l as m,p as k,v as q,z as R,y as H,E as L}from"./index-C4Um7Kjq.js";import{_ as W}from"./PageHeader-Czcs01bb.js";import{u as G}from"./todos-CucyvkVB.js";import{s as J}from"./sections-BygJVMTa.js";import{t as K}from"./tags-SncAe3P9.js";import"./todos-C-_Eh4lT.js";const Q={key:1,class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},X={key:0,class:"bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-200 p-4 rounded-md"},Y={key:0},Z={key:1},tt={class:"mt-1"},et={class:"mt-1"},ot={class:"mt-1"},st={class:"mt-1"},at=["value"],rt={class:"flex flex-wrap gap-2"},lt=["onClick"],dt={class:"flex items-center"},it={class:"pt-4 flex justify-end space-x-3 border-t border-gray-200 dark:border-gray-700"},nt=["disabled"],ct={key:0,class:"flex items-center"},ut={key:1},xt={__name:"TodoForm",setup(mt){const y=U(),D=B(),c=G(),_=p(!0),d=p(null),w=p([]),h=p([]),f=T(()=>D.params.id),u=T(()=>!!f.value),s=M({title:"",content:"",due_date:"",section:null,tag_ids:[],is_completed:!1});N(async()=>{try{await Promise.all([F(),V(),E()])}catch(a){console.error("Error initializing form:",a),d.value="Failed to load form data. Please try again."}finally{_.value=!1}});const F=async()=>{try{const a=await J.getSections();w.value=a.data.results}catch(a){console.error("Failed to load sections:",a)}},V=async()=>{try{const a=await K.getTags();h.value=a.data.results}catch(a){console.error("Failed to load tags:",a)}},E=async()=>{var a;if(u.value)try{const t=await c.fetchTodoById(f.value);let o="";if(t.due_date){const i=new Date(t.due_date);o=new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().substring(0,16)}s.title=t.title,s.content=t.content||"",s.due_date=o,s.section=((a=t.section)==null?void 0:a.id)||t.section||null,s.is_completed=t.is_completed||!1,t.tags&&Array.isArray(t.tags)&&(s.tag_ids=t.tags.map(i=>i.id))}catch(t){console.error("Failed to load todo:",t),d.value="Failed to load todo details"}},z=a=>{const t=s.tag_ids.indexOf(a.id);t===-1?s.tag_ids.push(a.id):s.tag_ids.splice(t,1)},A=async()=>{var a;d.value=null;try{const t={title:s.title,task:s.content,section:s.section,tag_ids:s.tag_ids,is_completed:s.is_completed,type:"todo",is_archived:!1};s.is_completed?t.completed_at=new Date().toISOString():t.completed_at=null,s.due_date&&(t.due_date=new Date(s.due_date).toISOString());let o;u.value?o=await c.updateTodo(f.value,t):o=await c.createTodo(t),y.push("/todos")}catch(t){console.error("Failed to save todo:",t),d.value=((a=t.response)==null?void 0:a.data)||"Failed to save todo. Please try again."}};return(a,t)=>(r(),S(I,{title:u.value?"Edit Todo":"New Todo"},{default:C(()=>[$(W,{title:u.value?"Edit Todo":"New Todo"},{actions:C(()=>[e("button",{onClick:t[0]||(t[0]=o=>g(y).back()),class:"btn bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 shadow-sm"}," Cancel ")]),_:1},8,["title"]),_.value?(r(),S(O,{key:0})):(r(),l("div",Q,[e("form",{onSubmit:j(A,["prevent"]),class:"p-6 space-y-6"},[d.value?(r(),l("div",X,[typeof d.value=="object"?(r(),l("p",Y,[(r(!0),l(v,null,b(d.value,(o,i)=>(r(),l("span",{key:i},[x(n(i)+": "+n(Array.isArray(o)?o.join(", "):o),1),t[7]||(t[7]=e("br",null,null,-1))]))),128))])):(r(),l("p",Z,n(d.value),1))])):P("",!0),e("div",null,[t[8]||(t[8]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[x(" Title "),e("span",{class:"text-red-500"},"*")],-1)),e("div",tt,[m(e("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=o=>s.title=o),type:"text",required:"",class:"input focus:ring-primary-500 focus:border-primary-500",placeholder:"What needs to be done?"},null,512),[[k,s.title]])])]),e("div",null,[t[9]||(t[9]=e("label",{for:"content",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Description ",-1)),e("div",et,[m(e("textarea",{id:"content","onUpdate:modelValue":t[2]||(t[2]=o=>s.content=o),rows:"3",class:"input focus:ring-primary-500 focus:border-primary-500",placeholder:"Add more details about this task"},null,512),[[k,s.content]])])]),e("div",null,[t[10]||(t[10]=e("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Due Date ",-1)),e("div",ot,[m(e("input",{id:"due_date","onUpdate:modelValue":t[3]||(t[3]=o=>s.due_date=o),type:"datetime-local",class:"input focus:ring-primary-500 focus:border-primary-500"},null,512),[[k,s.due_date]])])]),e("div",null,[t[12]||(t[12]=e("label",{for:"section",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Section ",-1)),e("div",st,[m(e("select",{id:"section","onUpdate:modelValue":t[4]||(t[4]=o=>s.section=o),class:"input focus:ring-primary-500 focus:border-primary-500"},[t[11]||(t[11]=e("option",{value:null},"None",-1)),(r(!0),l(v,null,b(w.value,o=>(r(),l("option",{key:o.id,value:o.id},n(o.title),9,at))),128))],512),[[q,s.section]])])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Tags ",-1)),e("div",rt,[(r(!0),l(v,null,b(h.value,o=>(r(),l("div",{key:o.id,onClick:i=>z(o),class:H(["px-3 py-1 rounded-full text-sm cursor-pointer",s.tag_ids.includes(o.id)?"text-white":"text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700"]),style:R(s.tag_ids.includes(o.id)?{backgroundColor:o.color}:{})},n(o.name),15,lt))),128))])]),e("div",dt,[m(e("input",{id:"is_completed","onUpdate:modelValue":t[5]||(t[5]=o=>s.is_completed=o),type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[L,s.is_completed]]),t[14]||(t[14]=e("label",{for:"is_completed",class:"ml-2 block text-sm text-gray-900 dark:text-white"}," Mark as completed ",-1))]),e("div",it,[e("button",{type:"button",onClick:t[6]||(t[6]=o=>g(y).back()),class:"btn bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}," Cancel "),e("button",{type:"submit",class:"btn-primary",disabled:g(c).loading},[g(c).loading?(r(),l("span",ct,t[15]||(t[15]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),x(" Saving... ")]))):(r(),l("span",ut,n(u.value?"Update Todo":"Create Todo"),1))],8,nt)])],32)]))]),_:1},8,["title"]))}};export{xt as default};
