import{r as p,c as S,B as E,a as j,o as A,b as C,w as D,d as N,u as I,f as a,g as U,i as r,h as e,q as y,k as g,t as d,s as O,A as $,j as H,F as v,m as x,l as m,p as b,v as P,z as q,y as R,E as L}from"./index-Cx2El54a.js";import{_ as W}from"./PageHeader-CLbsVlwg.js";import{u as G}from"./todos-vJPuSmwq.js";import{s as J}from"./sections-CkNSaj2W.js";import{t as K}from"./tags-DKUyxjwe.js";import"./todos-Q-LE40Es.js";const Q={class:"flex items-center gap-3"},X=["disabled"],Y={key:0,class:"animate-spin mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Z={key:1,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"mr-2 h-4 w-4"},tt={key:1,class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},et={key:0,class:"bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-200 p-4 rounded-md"},ot={key:0},st={key:1},it={class:"mt-1"},at={class:"mt-1"},rt={class:"mt-1"},lt={class:"mt-1"},nt=["value"],dt={class:"flex flex-wrap gap-2"},ut=["onClick"],ct={class:"flex items-center"},bt={__name:"TodoForm",setup(mt){const k=I(),V=E(),u=G(),w=p(!0),l=p(null),_=p([]),h=p([]),f=S(()=>V.params.id),c=S(()=>!!f.value),s=j({title:"",content:"",due_date:"",section:null,tag_ids:[],is_completed:!1});A(async()=>{try{await Promise.all([B(),F(),M()])}catch(i){console.error("Error initializing form:",i),l.value="Failed to load form data. Please try again."}finally{w.value=!1}});const B=async()=>{try{const i=await J.getSections();_.value=i.data.results}catch(i){console.error("Failed to load sections:",i)}},F=async()=>{try{const i=await K.getTags();h.value=i.data.results}catch(i){console.error("Failed to load tags:",i)}},M=async()=>{var i;if(c.value)try{const t=await u.fetchTodoById(f.value);let o="";if(t.due_date){const n=new Date(t.due_date);o=new Date(n.getTime()-n.getTimezoneOffset()*6e4).toISOString().substring(0,16)}s.title=t.title,s.content=t.content||"",s.due_date=o,s.section=((i=t.section)==null?void 0:i.id)||t.section||null,s.is_completed=t.is_completed||!1,t.tags&&Array.isArray(t.tags)&&(s.tag_ids=t.tags.map(n=>n.id))}catch(t){console.error("Failed to load todo:",t),l.value="Failed to load todo details"}},z=i=>{const t=s.tag_ids.indexOf(i.id);t===-1?s.tag_ids.push(i.id):s.tag_ids.splice(t,1)},T=async()=>{var i;l.value=null;try{const t={title:s.title,task:s.content!==""?s.content:"-",section:s.section,tag_ids:s.tag_ids,is_completed:s.is_completed,type:"todo",is_archived:!1};s.is_completed?t.completed_at=new Date().toISOString():t.completed_at=null,s.due_date&&(t.due_date=new Date(s.due_date).toISOString());let o;c.value?o=await u.updateTodo(f.value,t):o=await u.createTodo(t),k.push("/todos")}catch(t){console.error("Failed to save todo:",t),l.value=((i=t.response)==null?void 0:i.data)||"Failed to save todo. Please try again."}};return(i,t)=>(a(),C(N,{title:c.value?"Edit Todo":"New Todo"},{default:D(()=>[U(W,{title:c.value?"Edit Todo":"New Todo"},{actions:D(()=>[e("div",Q,[e("button",{type:"button",onClick:t[0]||(t[0]=o=>y(k).back()),class:"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring bg-transparent hover:bg-muted/80 text-muted-foreground border border-input px-4 py-2 shadow-sm"},t[6]||(t[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"mr-2 h-4 w-4"},[e("path",{d:"m12 19-7-7 7-7"}),e("path",{d:"M19 12H5"})],-1),g(" Back ")])),e("button",{type:"button",onClick:T,disabled:y(u).loading,class:"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring bg-primary text-primary-foreground hover:bg-primary/90 px-4 py-2 shadow disabled:pointer-events-none disabled:opacity-50"},[y(u).loading?(a(),r("svg",Y,t[7]||(t[7]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(a(),r("svg",Z,t[8]||(t[8]=[e("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"},null,-1),e("polyline",{points:"17 21 17 13 7 13 7 21"},null,-1),e("polyline",{points:"7 3 7 8 15 8"},null,-1)]))),g(" "+d(c.value?"Update Todo":"Create Todo"),1)],8,X)])]),_:1},8,["title"]),w.value?(a(),C(O,{key:0})):(a(),r("div",tt,[e("form",{onSubmit:$(T,["prevent"]),class:"p-6 space-y-6"},[l.value?(a(),r("div",et,[typeof l.value=="object"?(a(),r("p",ot,[(a(!0),r(v,null,x(l.value,(o,n)=>(a(),r("span",{key:n},[g(d(n)+": "+d(Array.isArray(o)?o.join(", "):o),1),t[9]||(t[9]=e("br",null,null,-1))]))),128))])):(a(),r("p",st,d(l.value),1))])):H("",!0),e("div",null,[t[10]||(t[10]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[g(" Title "),e("span",{class:"text-red-500"},"*")],-1)),e("div",it,[m(e("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=o=>s.title=o),type:"text",required:"",class:"input focus:ring-primary-500 focus:border-primary-500",placeholder:"What needs to be done?"},null,512),[[b,s.title]])])]),e("div",null,[t[11]||(t[11]=e("label",{for:"content",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Description ",-1)),e("div",at,[m(e("textarea",{id:"content","onUpdate:modelValue":t[2]||(t[2]=o=>s.content=o),rows:"3",class:"input focus:ring-primary-500 focus:border-primary-500",placeholder:"Add more details about this task"},null,512),[[b,s.content]])])]),e("div",null,[t[12]||(t[12]=e("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Due Date ",-1)),e("div",rt,[m(e("input",{id:"due_date","onUpdate:modelValue":t[3]||(t[3]=o=>s.due_date=o),type:"datetime-local",class:"input focus:ring-primary-500 focus:border-primary-500"},null,512),[[b,s.due_date]])])]),e("div",null,[t[14]||(t[14]=e("label",{for:"section",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Section ",-1)),e("div",lt,[m(e("select",{id:"section","onUpdate:modelValue":t[4]||(t[4]=o=>s.section=o),class:"input focus:ring-primary-500 focus:border-primary-500"},[t[13]||(t[13]=e("option",{value:null},"None",-1)),(a(!0),r(v,null,x(_.value,o=>(a(),r("option",{key:o.id,value:o.id},d(o.title),9,nt))),128))],512),[[P,s.section]])])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Tags ",-1)),e("div",dt,[(a(!0),r(v,null,x(h.value,o=>(a(),r("div",{key:o.id,onClick:n=>z(o),class:R(["px-3 py-1 rounded-full text-sm cursor-pointer",s.tag_ids.includes(o.id)?"text-white":"text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700"]),style:q(s.tag_ids.includes(o.id)?{backgroundColor:o.color}:{})},d(o.name),15,ut))),128))])]),e("div",ct,[m(e("input",{id:"is_completed","onUpdate:modelValue":t[5]||(t[5]=o=>s.is_completed=o),type:"checkbox",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[L,s.is_completed]]),t[16]||(t[16]=e("label",{for:"is_completed",class:"ml-2 block text-sm text-gray-900 dark:text-white"}," Mark as completed ",-1))])],32)]))]),_:1},8,["title"]))}};export{bt as default};
